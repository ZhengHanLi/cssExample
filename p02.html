<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
<link rel="stylesheet" href="reset.css">
    <style>
        *{
            padding: 0;
            margin: 0;
        }

        .header{
            width: 700px;
            height: 110px;
            margin: 20px auto 100px;
            background-color: #ffd;  
        }

        .header .drop2zone,
        .header .drop1zone{
            width: 60px;
            height: 90px;
            background-color: rgba(196, 196, 193, 0.538);
            display: inline-block;
            box-sizing: border-box;
            margin: 10px;
        }

        .header .drop1zone::after
        {
            content: 'Tmp';
            font-size: 25px;
            line-height: 90px;
            opacity: 0.3;
            z-index: 1;
        }

        .header .drop2zone::after
        {
            content: 'Ans';
            font-size: 25px;
            line-height: 90px;
            opacity: 0.3;
            z-index: 1;
        }


        .block{
            width: 700px;
            height: 100px;
            margin: 20px auto;
            background-color: #ffd;
        }

        .block .dropzone{
            width: 60px;
            height: 20px;
            background-color: #ff0;
            display: inline-block;
            box-sizing: border-box;

            margin: 0 10px;
        }

        .drag{
            height: 90px;
            width: 60px;
            font-size: 20px;
            /* background-color: red; */
            border: 1px solid #000;
            display: block;
            position: relative;
            z-index: 2;
        }
        .block .dropzone .drag > .drag{
            position: absolute; 
            top: 35px;
            /* background-color: yellow; */
        }

        .c1{
            background-color: rgb(167, 163, 163);
        }

        .c2{
            background-color: rgb(243, 32, 32);
        }

        .c3{
            background-color: rgb(151, 10, 76);
        }

        .c4{
            background-color: rgb(106, 110, 110);
        }
    </style>

    <script>
        window.onload=function(){

            const suits=['S','H','D','C']
            let row_Nums=[6,6,6,6,7,7,7,7]
            let card=new Array();
            let moveCnt=5;
            for(let suit of suits )
            {
                for( let i=1;i<=13;i++ )
                {
                    card.push({"suit":suit,"num":i})
                }
            }
            card.sort(() => Math.random() - 0.5);
            row_Nums.sort(() => Math.random() - 0.5);
            let cardlist=new Array();
            for( [index,num] of row_Nums.entries() )
            {
                cardlist[index]=card.splice(0,num)
            }
            // console.log(cardlist )

            let dropzones=document.querySelectorAll(".block .dropzone")

            for( [index,zone] of dropzones.entries() )
            {
                let len=cardlist[index].length
                // console.log(len )
                for( let i=0;i<len;i++ )
                {
                    var div = document.createElement('div');
                    div.classList.add("drag")
                    if( cardlist[index][i].suit=="S" )
                        div.classList.add("c1")
                    else if( cardlist[index][i].suit=="H" )
                        div.classList.add("c2")
                    else if( cardlist[index][i].suit=="D" )
                        div.classList.add("c3")
                    else if( cardlist[index][i].suit=="C" )
                        div.classList.add("c4")

                    div.draggable = true
                    div.textContent=""+cardlist[index][i].suit+" "+cardlist[index][i].num
                    div.dataset.suit = cardlist[index][i].suit;
                    div.dataset.num = cardlist[index][i].num;
                    if ( cardlist[index][i].suit=="S" || cardlist[index][i].suit=="C" )
                        div.dataset.color = "black";
                    else 
                        div.dataset.color = "red";
                    zone.appendChild(div )
                    zone=zone.querySelector(".drag")
                }
            }

            
            var dragged;
            /* events fired on the draggable target */
                // document.addEventListener("drag", function(event) {

            // }, false);

            document.addEventListener("dragstart", function(event) {
                // store a ref. on the dragged elem
                
                dragged = event.target;
                // make it half transparent
                event.target.style.opacity = .5;
            }, false);

            document.addEventListener("dragend", function(event) {
                // reset the transparency
                event.target.style.opacity = "";
            }, false);

            /* events fired on the drop targets */
            document.addEventListener("dragover", function(event) {
                // prevent default to allow drop
                event.preventDefault();
            }, false);

            document.addEventListener("dragenter", function(event) {
                // highlight potential drop target when the draggable element enters it
                if (event.target.className == "dropzone") {
                    event.target.style.background = "purple";
                }

            }, false);

            document.addEventListener("dragleave", function(event) {
                // reset background of potential drop target when the draggable element leaves it
                if (event.target.className == "dropzone") {
                    event.target.style.background = "";
                }

            }, false);

            document.addEventListener("drop", function(event) {
                // prevent default action (open as link for some elements)
                event.preventDefault();
                // move dragged elem to the selected drop target
                // console.log( dragged.dataset.suit )
                if( event.target.classList.contains("tmp") || event.target.className == "drop1zone" )
                {
                    // console.log( event.target )
                    if (event.target.className == "drop1zone" && dragged.childNodes.length==1)
                    {
                        // event.target.style.background = "";
                        dragged.parentNode.removeChild( dragged );
                        dragged.classList.add("tmp")
                        event.target.appendChild( dragged );
                        moveCnt--;
                    }
                }
                else if( event.target.className == "drop2zone" || event.target.classList.contains("ans") )
                {
                    if (event.target.className == "drop2zone" && dragged.dataset.num=="1" )
                    {
                        // event.target.style.background = "";
                        if(dragged.classList.contains("tmp") )
                            dragged.classList.remove("tmp")
                        dragged.parentNode.removeChild( dragged );
                        dragged.classList.add("ans")
                        event.target.appendChild( dragged );
                        moveCnt++;
                    }
                    else if ( dragged.dataset.suit==event.target.dataset.suit && parseInt(dragged.dataset.num)==parseInt(event.target.dataset.num)+1 )
                    {
                        // event.target.style.background = "";
                        if(dragged.classList.contains("tmp") )
                            dragged.classList.remove("tmp")
                        dragged.parentNode.removeChild( dragged );
                        dragged.classList.add("ans")
                        event.target.appendChild( dragged );
                        moveCnt++;
                    }
                }
                else if( event.target.childNodes.length==1 )
                {
                    if (event.target.className == "dropzone" ) {
                        // event.target.style.background = "";
                        dragged.parentNode.removeChild( dragged );
                        if(dragged.classList.contains("tmp") )
                            dragged.classList.remove("tmp")
                        event.target.appendChild( dragged );
                        moveCnt++;
                    }
                    else if ( dragged.dataset.color!=event.target.dataset.color && parseInt(dragged.dataset.num)==parseInt(event.target.dataset.num)-1 ) {
                        // event.target.style.background = "";
                        dragged.parentNode.removeChild( dragged );
                        if(dragged.classList.contains("tmp") )
                            dragged.classList.remove("tmp")
                        event.target.appendChild( dragged );
                        moveCnt++;
                    }
                }

            }, false);
        }
    </script>
</head>
<body>
    <div class="header">
        <div class="drop1zone">

        </div>
        <div class="drop1zone">
            
        </div>
        <div class="drop1zone">
            
        </div>
        <div class="drop1zone">
            
        </div>
        <div class="drop2zone">
            
        </div>
        <div class="drop2zone">
            
        </div>
        <div class="drop2zone">
            
        </div>
        <div class="drop2zone">
            
        </div> 
    </div>

    <div class="block">
        <div class="dropzone">

        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
        <div class="dropzone">
            
        </div>
    </div>
</body>
</html>